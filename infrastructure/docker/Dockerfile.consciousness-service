# Consciousness Service - Living Prompts and Sigil Processing
FROM memmimic-base:latest

LABEL service="consciousness-service" \
      description="MemMimic consciousness integration and living prompts service" \
      version="1.0.0"

# Set service-specific environment variables
ENV SERVICE_NAME=consciousness-service \
    SERVICE_PORT=8005 \
    CONSCIOUSNESS_CACHE_PATH=/app/consciousness_cache \
    RUP_ENGINE_ENABLED=true

# Create consciousness cache directory
RUN mkdir -p /app/consciousness_cache && chown memmimic:memmimic /app/consciousness_cache

# Copy service-specific configuration
COPY infrastructure/config/consciousness-service.yaml ./config/

# Copy consciousness service components
COPY src/memmimic/consciousness/ ./src/memmimic/consciousness/
COPY src/memmimic/errors/ ./src/memmimic/errors/
COPY src/memmimic/security/ ./src/memmimic/security/

# Copy consciousness cache data
COPY src/memmimic/memmimic_cache/ ./memmimic_cache/

# Expose service port
EXPOSE 8005

# Health check
HEALTHCHECK --interval=30s --timeout=10s --start-period=10s --retries=3 \
    CMD curl -f http://localhost:8005/health || exit 1

# Start consciousness service
CMD ["gunicorn", "--bind", "0.0.0.0:8005", "--workers", "2", "--worker-class", "uvicorn.workers.UvicornWorker", "memmimic.services.consciousness:app"]